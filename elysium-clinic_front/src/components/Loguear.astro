---
import ButtonMain from "./misc/ButtonMain.astro";
---
<!-- Agregue el link a las paginas correspondiente -->
<div class="bg-slate-100 dark:bg-muted-1000 w-full  py-8 pt-16">
    <div class="container bg-white shadow-2xl m-auto p-5 rounded-xl w-[420px] h-[700px]">
        <img src="../../public/assets/solo-img.webp" class=" w-28 mb-5 m-auto block" alt="" />
        <h1 class="text-3xl font-bold text-center mt-10">LOGIN</h1>
        <form class="flex flex-col " id="loginForm" >
            <input
                class="p-3 mb-3 border-solid border-slate-200 border-2 rounded-lg" 
                type="text"
                name="email"
                placeholder="Ingrese su correo"
                id="email"
                required
            />
            <input
                class="p-3 mb-3 border-solid border-slate-200 border-2 rounded-lg"
                type="password"
                name="password"
                placeholder="Ingrese su contraseña"
                id="password"
                required
            />
            <span class="text-end py-4"> <a class="text-primary-500 font-medium" href="">Olvidaste tu contraseña?</a></span>
            <ButtonMain type="submit">Login</ButtonMain>
            <span class="mt-20 text-end ">¿No tienes una cuenta? <a class="text-primary-500 font-medium" href="/registro" >Registrate</a></span>
        </form>
    </div>
    </div>
    
    <script>
        
            const loginForm = document.getElementById('loginForm');
            
            loginForm?.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = (document.getElementById('email') as HTMLInputElement).value;
                const password = (document.getElementById('password') as HTMLInputElement).value;
                
                try {
                    const response = await fetch('http://localhost:4000/api/users/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    })
                   
                    .then((response) => response.json());
                    
                    
                    
                    
                    if (response.status=== 200) {
                        const {data} = await response.data;
                        
                        // Guardar token en localStorage
                        localStorage.setItem('accessToken', data.token);
                        
                        // Redirigir al dashboard o página principal
                        window.location.href = '/dashboard';
                    } else {
                        const errorData = await response.json();
                        alert(errorData.message || 'Error en el inicio de sesión');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Ocurrió un error al iniciar sesión');
                }
            });
        
    </script>

    <style>
    
    .container h1 {
        background: linear-gradient(90deg, #8080fb 0%, #ec70ee 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    </style>