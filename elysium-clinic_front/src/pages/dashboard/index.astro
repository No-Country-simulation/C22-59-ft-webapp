---
import DashboardLayout from "../../layouts/DashboardLayout.astro"
---
<DashboardLayout title="Dasboard"> 

	<div class="mt-28 px-[15%] py-10 pb-8">
        <div
            class="flex flex-row w-full justify-between gap-4 flex-wrap lg:flex-nowrap"
        >
            <div
                class="bg-white shadow-lg lg:w-1/3 w-full rounded-2xl p-6 flex flex-col items-center justify-center gap-4"
            >
                <!-- TOP -->
                <div
                    class="flex flex-row w-full justify-center gap-4 items-start"
                >
                    <svg
                        class="h-6 w-6"
                        fill="#000000"
                        viewBox="0 0 1000 1000"
                        xmlns="http://www.w3.org/2000/svg"
                        ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g
                            id="SVGRepo_tracerCarrier"
                            stroke-linecap="round"
                            stroke-linejoin="round"></g><g
                            id="SVGRepo_iconCarrier"
                            ><path
                                d="M790 166h-41V83h-84v83H333V83h-83v83h-42q-34 0-58.5 24.5T125 250v582q0 34 24 58.5t59 24.5h582q35 0 59-24.5t24-58.5V250q0-35-24.5-59.5T790 166zm0 666H208V374h582v458zM291 457h208v208H291V457z"
                            ></path></g
                        ></svg
                    >


                    <h2 class="text-2xl font-semibold mb-2">
                        Citas Canceladas
                    </h2>
                </div>
                <div class="flex flex-col items-center justify-center">
                    <p id="cancelledCitas" class="text-3xl font-bold">0</p>
                </div>
            </div>
            <div
                class="bg-white shadow-lg lg:w-1/3 w-full rounded-2xl p-6 flex flex-col items-center justify-center gap-4"
            >
                <!-- TOP -->
                <div
                    class="flex flex-row w-full justify-center gap-4 items-start"
                >
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        class="h-6 w-6"
                        xmlns="http://www.w3.org/2000/svg"
                        ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g
                            id="SVGRepo_tracerCarrier"
                            stroke-linecap="round"
                            stroke-linejoin="round"></g><g
                            id="SVGRepo_iconCarrier"
                        >
                            <path
                                d="M9 20H6C3.79086 20 2 18.2091 2 16V7C2 4.79086 3.79086 3 6 3H17C19.2091 3 21 4.79086 21 7V10"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M8 2V4"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M15 2V4"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M2 8H21"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <path
                                d="M18.5 15.6429L17 17.1429"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></path>
                            <circle
                                cx="17"
                                cy="17"
                                r="5"
                                stroke="#000000"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"></circle>
                        </g></svg
                    >
                    <h2 class="text-2xl font-semibold mb-2">
                        Citas Confirmadas
                    </h2>
                </div>
                <div class="flex flex-col items-center justify-center">
                    <p id="confirmedCitas" class="text-3xl font-bold">0</p>
                </div>
            </div>
            <div
                class="bg-white shadow-lg lg:w-1/3 w-full rounded-2xl p-6 flex flex-col items-center justify-center gap-4"
            >
                <!-- TOP -->
                <div
                    class="flex flex-row w-full justify-center gap-4 items-start"
                >
                    <svg
                        class="h-6 w-6"
                        viewBox="0 0 24 24"
                        id="_24x24_On_Light_Schedule-Add"
                        data-name="24x24/On Light/Schedule-Add"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="#000000"
                        ><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g
                            id="SVGRepo_tracerCarrier"
                            stroke-linecap="round"
                            stroke-linejoin="round"></g><g
                            id="SVGRepo_iconCarrier"
                        >
                            <rect
                                id="view-box"
                                width="24"
                                height="24"
                                fill="none"></rect>
                            <path
                                id="Shape"
                                d="M2.75,17.5A2.753,2.753,0,0,1,0,14.75v-10A2.754,2.754,0,0,1,2.5,2.012V.75A.75.75,0,0,1,4,.75V2h9.5V.75a.75.75,0,0,1,1.5,0V2.012A2.753,2.753,0,0,1,17.5,4.75v10a2.752,2.752,0,0,1-2.75,2.75ZM1.5,4.75v10A1.251,1.251,0,0,0,2.75,16h12A1.251,1.251,0,0,0,16,14.75v-10A1.251,1.251,0,0,0,14.75,3.5h-12A1.251,1.251,0,0,0,1.5,4.75Zm6.5,8V10.5H5.75a.75.75,0,0,1,0-1.5H8V6.75a.75.75,0,0,1,1.5,0V9h2.25a.75.75,0,0,1,0,1.5H9.5v2.25a.75.75,0,0,1-1.5,0Z"
                                transform="translate(3.25 3.25)"
                                fill="#141124"></path>
                        </g></svg
                    >
                    <h2 class="text-2xl font-semibold mb-2">
                        Citas Pendientes
                    </h2>
                </div>
                <div class="flex flex-col items-center justify-center">
                    <p id="pendingCitas" class="text-3xl font-bold">0</p>
                </div>
            </div>
        </div>



		<div
			class="bg-white shadow-lg rounded-2xl p-8 mt-20 mb-20 flex flex-col items-start w-[80%] mx-auto"
		>
			<div class="w-full flex justify-between items-center mb-4">
				<h2 class="text-2xl font-semibold">Historial de Citas</h2>
				<div class="flex space-x-4">
					
					<select
						id="statusFilter"
						class="px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
					>
						<option value="">Todos los estados</option>
						<option value="Reservado">Reservado</option>
						<option value="Completado">Completado</option>
						<option value="Cancelado">Cancelado</option>
					</select>
				</div>
			</div>

			<div class="overflow-x-auto w-full">	
				<table id="appointmentsTable" class="w-full">
					<thead class="bg-gray-100">
						<tr>
							<th class="text-left p-3">Paciente</th>
							
							<th class="text-left p-3">Fecha</th>
							<th class="text-left p-3">Hora</th>
							<th class="text-left p-3">Estado</th>
						</tr>
					</thead>
					<tbody id="tableBody" class="divide-y divide-gray-200">
						<!-- Las filas se generarán dinámicamente -->
					</tbody>
				</table>

				<!-- Paginación -->
				<div
					id="pagination"
					class="flex justify-between items-center mt-4"
				>
					<span id="pageInfo" class="text-gray-600"></span>
					<div class="space-x-2">
						<button
							id="prevPage"
							class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300"
						>
							Anterior
						</button>
						<button
							id="nextPage"
							class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300"
						>
							Siguiente
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

</DashboardLayout>


<script>
	const tableBody = document.getElementById("tableBody");

	// const user = await fetch('http://localhost:4000/api/appointments/user/6758b73ed2a028ea00477710');
	// console.log(await user.json());
	
	const response = await fetch('http://localhost:4000/api/appointments/user/6758b73ed2a028ea00477710', {
		method: 'GET',
		headers: {
		'Content-Type': 'application/json',
		'authorization':localStorage.getItem('accessToken')??"",
		},
	});
	const data = (await response.json()).data;
	const pendingCitasP = document.getElementById("pendingCitas");
	const confirmedCitasP = document.getElementById("confirmedCitas");
	const cancelledCitasP = document.getElementById("cancelledCitas");
	console.log(data);

	data.forEach((app: any) => {
		const row = document.createElement("tr");

		let col =  "bg-green-100 text-green-800"

		if (app.status === "scheduled")
			col = "bg-yellow-100 text-yellow-800"
			
			
		if (app.status === "cancelled")
			col = "bg-red-100 text-red-800"

		row.innerHTML = `
		<td class="p-3">${app.doctor.name}</td>
		<td class="p-3">${app.date.split("T")[0]}</td>
		<td class="p-3">${app.date.split("T")[1].split(".")[0]}</td>
		<td class="p-3">
			<span class="px-2 py-1 rounded-full text-xs ${col}">${app.status}</span>
		</td>`;
		tableBody?.appendChild(row);

		if(pendingCitasP && app.status === "scheduled")
			pendingCitasP.innerHTML = "" + (parseInt(pendingCitasP.innerHTML) + 1);
		if(confirmedCitasP && app.status === "completed")
			confirmedCitasP.innerHTML = "" + (parseInt(confirmedCitasP.innerHTML) + 1);
		if(cancelledCitasP && app.status === "cancelled")	
			cancelledCitasP.innerHTML = "" + (parseInt(cancelledCitasP.innerHTML) + 1);
	});

</script>